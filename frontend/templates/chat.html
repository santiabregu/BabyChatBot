<!DOCTYPE html>
<html>
<head>
    <title>Pregnancy Chat</title>
    <link rel="stylesheet" href="/static/chat.css">
</head>
<body>
    <div class="chat-page">
        <header class="chat-header">
            <h1>ğŸ‘¶ Welcome, {{ user_name }}! ğŸŒ¸</h1>
            <div class="chat-buttons">
                <button onclick="window.location.href='/facts'">ğŸ¼ Show Interesting Facts</button>
                <button onclick="window.location.href='/profile'">âœï¸ Edit Profile</button>
                <button onclick="window.location.href='/logout'">ğŸšª Logout</button>
            </div>
        </header>
        <main class="chat-main">
            <div id="chat-history" class="chat-history"></div>
        </main>
        <footer class="chat-footer">
            <form id="chat-form" class="chat-form">
                <input type="text" id="user_message" name="user_message" placeholder="Ask me anything about your pregnancy..." required>
                <button type="submit">ğŸ’¬ Send</button>
            </form>
        </footer>
    </div>
    <script>
        const form = document.getElementById("chat-form");
        const chatHistory = document.getElementById("chat-history");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const userMessage = document.getElementById("user_message").value;

            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams({ user_message: userMessage }),
            });

            const data = await response.json();
            const botMessage = data.response;

            const userMessageElement = document.createElement("p");
            userMessageElement.innerHTML = `<strong>You:</strong> ${userMessage}`;
            chatHistory.appendChild(userMessageElement);

            const botMessageElement = document.createElement("div");
            botMessageElement.innerHTML = `
                <strong>Bot:</strong>
                <p>${botMessage
                    .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>") // Bold text
                    .replace(/\n/g, "<br>") // Line breaks
                    .replace(/\* (.*?)\n/g, "<li>$1</li>") // Convert bullet points to list items
                }</p>
            `;
            chatHistory.appendChild(botMessageElement);

            document.getElementById("user_message").value = "";
        });
    </script>
</body>
</html>